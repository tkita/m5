<!DOCTYPE html>
<html>
    <head>
	<meta charset="UTF-8">
	<!-- <meta http-equiv="X-UA-Compatible" content="IE=11" /> -->
	<meta name="viewport"
	      content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
	<title>m5</title>

	<style>
	 .gm-style > div > div > div > div > div > div {
	     font-size: small;
	     opacity: 0.7;
	 }
	</style>

	<script>
	 // var opener = window.dialogArguments;

	 function drawPolyline ( map, path, option ) {
	     option.path = path;
	     option.geodesic = true;
	     var objPolyline = new google.maps.Polyline( option );
	     objPolyline.setMap( map );
	 }

	 function makeMarker( map, lat, lng, image, opt_msg ) {
	     var marker = new google.maps.Marker(
		 { map: map,
		   position: new google.maps.LatLng( lat, lng ),
		   icon: new google.maps.MarkerImage( image )
		 } );

	     google.maps.event.
		    addListener( marker, 'click',
				 function( event ) {
				     new google.maps.InfoWindow( { content: opt_msg } ).
						open( marker.getMap(), marker );

				     new google.maps.Circle(
					 { strokeColor: 'green',
					   strokeOpacity: 0.3,
					   strokeWeight: 3,
					   fillColor: '#ff1493',
					   fillOpacity: 0,
					   clickable: false,
					   map: map,
					   center: new google.maps.LatLng( lat, lng ),
					   radius: 1000   // 半径 1000 m
					 } );
				 });
	     return marker;
	 }

         function init () {
             var options = { center: new google.maps.LatLng( '43.061945', '141.354395' ),
                             panControl: false,
                             scaleControl: true,
                             zoomControlOptions: { style: google.maps.ZoomControlStyle.SMALL },
                             zoom: 12,
                             mapTypeId: google.maps.MapTypeId.ROADMAP
             };
             var map = new google.maps.Map( document.getElementById( 'all_map' ), options );

	     // main

	     var markerImage = {
		 '10': 'build',     // 代表
		 '11': 'build',     // 総務局
		 '12': 'build',     // 財政局
		 '13': 'build',     // 市民文化局
		 '14': 'build',     // 経済観光局
		 '15': 'build',     // スポーツ局
		 '16': 'build',     // 保健福祉局
		 '17': 'build',     // 子ども未来局
		 '18': 'tulip',     // ちあふる
		 '19': 'tulip',     // 保育園
		 '20': 'build',     // 環境局
		 '21': 'build',     // 建設局
		 '22': 'build',     // 下水道河川局
		 '23': 'build',     // 交通局
		 '24': 'build',     // 水道局
		 '25': 'build',     // 市立札幌病院
		 '26': 'fire',      // 消防局
		 '27': 'build',     // 土木センター
		 '28': 'people',    // まちセン
		 '29': 'build',     // 教育委員会
		 '30': 'build',     // 図書館
		 '31': 'school',    // 小学校
		 '32': 'school',    // 中学校
		 '33': 'school',    // 高等学校
		 '34': 'school',    // 中等教育学校
		 '35': 'school',    // 特別支援学校
		 '36': 'school',    // 幼稚園
		 '37': 'station',   // 地下鉄
		 '38': 'station',   // ＪＲ駅
	     };

             Object.keys( objWorkplace ).forEach( function ( key ) {
		 var image = 'https://tkita.github.io/m5/resources/' +
			     markerImage[key] + '.png';
                 objWorkplace[ key ].data.forEach( function ( data ) {
		     var name = data.split( ',' )[0]
		     var build = data.split( ',' )[1]
		     var addr = data.split( ',' )[2]
                     var lat = data.split( ',' )[3]
                     var lng = data.split( ',' )[4]
                     // console.info( lat, lng );
		     var marker = makeMarker( map, lat, lng, image,
					      name + '<br>' + build + '<br>' + addr );
                 });
             });

	     Object.keys( objKuBorder ).forEach( function ( ku ) {
		 var path = objKuBorder[ ku ].split( ' ' ).map( function( e ) {
		     var c = e.split( ',' );
		     return { lat: Number( c[1] ),
			      lng: Number( c[0] ) }
		 });

		 drawPolyline( map, path, { strokeColor: 'red',
					    strokeOpacity: 0.5,
					    strokeWeight: 2 } );
	     });
         }

        </script>

        <style>
         #all_map {
	     width: 100%;
	     height: 100%;
         }
        </style>
    </head>

    <body>
        <div id="all_map"></div>
	<script type="text/jscript" src="./data/objwp.js"></script>
	<script type="text/jscript" src="./data/objkuborder.js"></script>
	<script type="text/jscript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC78j0reQqOofNHQxsINRTt21UgyVK1MTo&libraries=geometry&callback=init"></script>
    </body>
</html>
