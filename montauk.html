<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11" />
        <!-- <script type="text/javascript"
	     src="http://maps.google.com/maps/api/js?sensor=false"></script>
           -->
        <script type="text/jscript"
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC78j0reQqOofNHQxsINRTt21UgyVK1MTo"></script>
        <script type="text/javascript">
         var map;
         var directions;
         var myOptions;
         var plinePink = new google.maps.Polyline( { strokeOpacity: 0.5,
                                                     strokeWeight: 5,
                                                     strokeColor: '#FF66FF' } );
         var plineBlue = new google.maps.Polyline( { strokeOpacity: 0.5,
                                                     strokeWeight: 5,
                                                     strokeColor: '#73B9FF' } );
         var dRenderer = new google.maps.DirectionsRenderer();
         var dService = new google.maps.DirectionsService();
         var transitLayer = new google.maps.TransitLayer();
      
         function init() {
             myOptions = { zoom: 16,
                           center: new google.maps.LatLng( 43.061970, 141.354514 ),
                           panControl: false,
                           scaleControl: true,
                           mapTypeId: google.maps.MapTypeId.ROADMAP, // TERRAIN
                           zoomControlOptions: { style: google.maps.ZoomControlStyle.SMALL }
             };
             map = new google.maps.Map( document.getElementById( 'map_canvas' ), myOptions );
             dRenderer.setMap( map );
             transitLayer.setMap( map );
             dRenderer.setPanel( document.getElementById('route') );
	 
             google.maps.event.addListener( map, 'click', function( e ) {
                 document.getElementById('mLat').value = e.latLng.lat();
                 document.getElementById('mLng').value = e.latLng.lng(); 
             } );
         };

         function dispRoute() {
             var mode = google.maps.DirectionsTravelMode.WALKING;
             dRenderer.setOptions( { polylineOptions: plinePink } );
             if ( document.getElementsByName( 'mode' )[1].checked ) {
                 mode = google.maps.DirectionsTravelMode.DRIVING;
                 dRenderer.setOptions( { polylineOptions: plineBlue } );
             };

             var request = { 
                 origin: document.getElementById( 'fromLat' ).value + ', ' + document.getElementById( 'fromLng' ).value,
                 destination: document.getElementById( 'toLat' ).value + ', ' + document.getElementById( 'toLng' ).value,
                 avoidHighways: true,  // 高速道路を除外
                 avoidTolls: true,     // 有料区間を除外
                 travelMode: mode
             };

             dService.route( request, function( result, status ) { 
                 if ( status == google.maps.DirectionsStatus.OK ) { 
                     dRenderer.setDirections( result );
                 } else {
                     alert( 'DirectionsService: ' + status );
                 };
             } );
         };

         function convCoords( addr, lat, lng ) {
	     document.getElementById( lat ).value = '';
	     document.getElementById( lng ).value = '';
	     var ad = document.getElementById( addr ).value;
	     if ( ad == '') {
                 alert( '住所を入力してください' );
                 return;
	     };
	     var geocoder = new google.maps.Geocoder();
	     geocoder.geocode( { 'address': ad,
                                 'region': 'jp'},
                               function( results, status ) {
                                   if ( status == google.maps.GeocoderStatus.OK ) {
				       var latlng = results[0].geometry.location;
				       document.getElementById( lat ).value = latlng.lat();
				       document.getElementById( lng ).value = latlng.lng();
                                   } else {
				       alert( 'geocoder: ' + status );
                                   };
                               } );
         };

         function moveCoords( lat, lng ) {
	     if (document.getElementById( 'mLat' ).value == '' || document.getElementById( 'mLng' ).value == '') {
                 alert( '空欄です' );
                 return;
	     };
	     document.getElementById( lat ).value = document.getElementById( 'mLat' ).value;
	     document.getElementById( lng ).value = document.getElementById( 'mLng' ).value;
	     document.getElementById( 'mLat' ).value = '';
	     document.getElementById( 'mLng' ).value = '';

	     if ( lat == 'fromLat' ) {
                 document.getElementById( 'fromAddr' ).value = '';
	     } else {
                 document.getElementById( 'toAddr' ).value = '';
	     };
         };
        </script>

        <style type="text/css">
         table { border-collapse: collapse; }
         .origin { background-color: #ccffcc; }
         .desti  { background-color: #ffccff; }
         tr.dispRoute { background-color: #ffffcc; }
         td { padding: 0.2em; }
        </style>

    </head>
    <body onload="init()">
        <table border="1">

            <tr class="origin">
                <td rowspan="2">
                    <img src="http://maps.google.co.jp/mapfiles/ms/icons/green.png">出発地点
                </td>
                <td colspan="4">
                    住所：<input type="text" id="fromAddr" size="60" value="札幌市中央区南３条西１１丁目" />
                </td>
            </tr>

            <tr class="origin">
                <td colspan="2" align="right">
                    <input type="button" value="座標へ変換" onclick="convCoords('fromAddr', 'fromLat', 'fromLng')" />
                </td>
                <td><input type="text" id="fromLat" value="" /></td>
                <td><input type="text" id="fromLng" value="" /></td>
            </tr>

            <tr class="desti">
                <td rowspan="2">
                    <img src="http://maps.google.co.jp/mapfiles/ms/icons/pink.png">到着地点
                </td>
                <td colspan="4">
                    住所：<input type="text" id="toAddr" size="60" value="札幌市中央区北１条西２丁目" />
                </td>
            </tr>

            <tr class="desti">
                <td colspan="2" align="right"><input type="button" value="座標へ変換" onclick="convCoords('toAddr', 'toLat', 'toLng')" /></td>
                <td><input type="text" id="toLat" value="" /></td>
                <td><input type="text" id="toLng" value="" /></td>
            </tr>

            <tr>
                <td rowspan="2"><img src="http://maps.google.com/mapfiles/ms/micons/POI.png">マウスクリックした地点</td>
                <td><input type="text" id="mLat" value="" /></td>
                <td><input type="text" id="mLng" value="" /></td>
                <td colspan="2" class="origin" align="center"><input type="button" value="出発地点へセット" onClick="moveCoords('fromLat', 'fromLng')" /></td>
            </tr>

            <tr>
                <td></td>
                <td></td>
                <td colspan="2" class="desti" align="center"><input type="button" value="到着地点へセット" onClick="moveCoords('toLat', 'toLng')" /></td>
            </tr>

            <tr class="dispRoute">
                <td><img src="http://maps.google.co.jp/mapfiles/ms/icons/motorcycling.png"></td>
                <td>
                    <input type="radio" name="mode" value="WALKING" checked> 徒歩<br>
                    <input type="radio" name="mode" value="DRIVING"> 自動車
                </td>
                <td colspan="3" align="center"><input type="button" value="ルート案内" onclick="dispRoute()" /></td>
            </tr>

            <tr>
                <td colspan="5">
	            <div id="map_canvas" style="width: 900px; height: 600px"></div>
                </td>
            </tr>

            <tr>
                <td colspan="5">
	            <div id="route" style="width: 900px; height: 200px; overflow: scroll"></div>
                </td>
            </tr>

        </table>
    </body>
</html>
